---
- name: Deploy the Cilium Helm chart
  kubernetes.core.k8s:
    resource_definition:
      apiVersion: helm.cattle.io/v1
      kind: HelmChart
      metadata:
        name: cilium
        namespace: kube-system
      spec:
        chart: cilium
        repo: https://helm.cilium.io/
        version: 1.18.2
        targetNamespace: kube-system
        createNamespace: false
        bootstrap: true
        failurePolicy: abort
        set:
          kubeProxyReplacement: 'true'
          k8sServiceHost: "{{ default_network_address }}"
          k8sServicePort: '6443'
          ipam.operator.clusterPoolIPv4PodCIDRList: "10.42.0.0/16"

